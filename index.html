<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Partner Link Form Test</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <h1>Partner Link Form Test</h1>

  <form id="test-form">
    <div class="form-group">
      <label for="fname">First Name</label>
      <input type="text" id="fname" name="FName" required>
    </div>

    <div class="form-group">
      <label for="lname">Last Name</label>
      <input type="text" id="lname" name="LName" required>
    </div>

    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" id="email" name="Email" required>
    </div>

    <div class="form-group">
      <label for="phone">Phone</label>
      <input type="tel" id="phone" name="Phone" required>
    </div>

    <button type="submit">Submit</button>
  </form>

  <div id="output"></div>

  <!-- Partner Link Script -->
  <script src="https://widget.partner.io/partnerLink.js"></script>
  <script>
    window.partnerLinkLibrary.init();
  </script>

  <!-- JS Tracking -->
  <script>

    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('test-form');
      const output = document.getElementById('output');

      if (!form) {
        output.innerHTML = 'ERROR: Form not found';
        return;
      }

      form.addEventListener('submit', function (event) {
        event.preventDefault();

        output.innerHTML = 'Processing...';

        // Check if Partner Link library is loaded
        if (!window.partnerLinkLibrary) {
          output.innerHTML = 'ERROR: Partner Link library not loaded';
          return;
        }

        // Extract form data
        const signUpData = window.partnerLinkLibrary.getSignUpDataFromFormElement(form);
        console.log('Extracted data:', signUpData);

        // Send to Partner.io (fire and forget - don't await)
        if (signUpData && signUpData.length > 0) {
          window.partnerLinkLibrary.recordSignUpEvent(signUpData)
            .then(function (statusCode) {
              console.log('API status code:', statusCode);

              output.innerHTML = `
            <strong>SUCCESS</strong><br>
            Status Code: ${statusCode}<br>
            Data sent: ${JSON.stringify(signUpData, null, 2)}<br>
            Check Network tab for POST to /tracking/partner-links
          `;

              form.reset();
            })
            .catch(function (error) {
              console.error('Error:', error);
              output.innerHTML = `<strong>FAILED</strong><br>${error.message}`;
            });
        } else {
          output.innerHTML = 'ERROR: No form data extracted';
        }
      });
    });

    // const form = document.getElementById('test-form');
    // const output = document.getElementById('output');

    // form.addEventListener('submit', async function (event) {
    //   event.preventDefault();

    //   output.innerHTML = 'Processing...';

    //   if (!window.partnerLinkLibrary) {
    //     output.innerHTML = 'ERROR: Partner Link library not loaded';
    //     return;
    //   }

    //   try {
    //     // Extract form data
    //     const signUpData = window.partnerLinkLibrary.getSignUpDataFromFormElement(form);
    //     console.log('Extracted data:', signUpData);

    //     // Send to Partner.io
    //     const statusCode = await window.partnerLinkLibrary.recordSignUpEvent(signUpData);
    //     console.log('API status code:', statusCode);

    //     output.innerHTML = `
    //       <strong>SUCCESS</strong><br>
    //       Status Code: ${statusCode}<br>
    //       Data sent: ${JSON.stringify(signUpData, null, 2)}<br>
    //       Check Network tab for POST to /tracking/partner-links
    //     `;

    //     form.reset();
    //   } catch (error) {
    //     console.error('Error:', error);
    //     output.innerHTML = `<strong>FAILED</strong><br>${error.message}`;
    //   }
    // });
  </script>
</body>

</html>
